<div class="container mt-4">
    <div class="card">
      <div class="card-header bg-info text-white">
        <h2 class="mb-0">Offres de stage disponibles</h2>
      </div>
      <div class="card-body">
        <!-- Barre de recherche -->
        <div class="row mb-4">
          <div class="col-md-6 offset-md-3">
            <div class="input-group">
              <input 
                type="text" 
                class="form-control" 
                placeholder="Rechercher par titre, entreprise, lieu ou compétences..." 
                [(ngModel)]="searchTerm"
                (input)="filterOffres()">
              <button class="btn btn-outline-secondary" type="button">
                <i class="bi bi-search"></i>
              </button>
            </div>
          </div>
        </div>
  
        <!-- Loader -->
        <div *ngIf="isLoading" class="text-center">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Chargement...</span>
          </div>
        </div>
  
        <!-- Message d'erreur -->
        <div *ngIf="errorMessage" class="alert alert-danger">
          {{ errorMessage }}
        </div>
  
        <!-- Message si aucune offre -->
        <div *ngIf="!isLoading && filteredOffres.length === 0" class="alert alert-info">
          Aucune offre de stage disponible pour le moment.
        </div>
  
        <!-- Liste des offres -->
        <div *ngIf="!isLoading && filteredOffres.length > 0" class="row">
          <div *ngFor="let offre of filteredOffres" class="col-md-6 mb-4">
            <div class="card h-100 shadow-sm">
              <div class="card-header bg-light">
                <h5 class="card-title mb-0">{{ offre.titre }}</h5>
                <h6 class="text-muted mb-0">{{ offre.entreprise }}</h6>
              </div>
              <div class="card-body">
                <div class="mb-2">
                  <span class="badge bg-secondary me-2">{{ offre.lieu }}</span>
                  <span class="badge bg-info">{{ offre.periode }}</span>
                </div>
                <p class="card-text">{{ offre.description | slice:0:150 }}{{ offre.description.length > 150 ? '...' : '' }}</p>
                <p class="card-text">
                  <strong>Compétences requises:</strong> {{ offre.competencesRequises }}
                </p>
                <p *ngIf="offre.remuneration" class="card-text">
                  <strong>Rémunération:</strong> {{ offre.remuneration }}
                </p>
              </div>
              <div class="card-footer bg-white d-flex justify-content-between align-items-center">
                <small class="text-muted">Publié le {{ offre.datePublication | date:'dd/MM/yyyy' }}</small>
                <div>
                  <button type="button" class="btn btn-sm btn-primary" data-bs-toggle="modal" [attr.data-bs-target]="'#detailModal' + offre.id">
                    Détails
                  </button>
                  <a *ngIf="offre.lienExterne" [href]="offre.lienExterne" target="_blank" class="btn btn-sm btn-outline-primary ms-2">
                    Site web
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  
    <!-- Modals pour les détails -->
    <div *ngFor="let offre of filteredOffres" class="modal fade" [id]="'detailModal' + offre.id" tabindex="-1" aria-labelledby="detailModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="detailModalLabel">{{ offre.titre }}</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-md-6">
                <p><strong>Entreprise:</strong> {{ offre.entreprise }}</p>
                <p><strong>Lieu:</strong> {{ offre.lieu }}</p>
                <p><strong>Période:</strong> {{ offre.periode }}</p>
                <p *ngIf="offre.remuneration"><strong>Rémunération:</strong> {{ offre.remuneration }}</p>
              </div>
              <div class="col-md-6">
                <p><strong>Date de publication:</strong> {{ offre.datePublication | date:'dd/MM/yyyy' }}</p>
                <p><strong>Compétences requises:</strong> {{ offre.competencesRequises }}</p>
                <p *ngIf="offre.lienExterne">
                  <strong>Lien externe:</strong> 
                  <a [href]="offre.lienExterne" target="_blank">{{ offre.lienExterne }}</a>
                </p>
              </div>
            </div>
            <hr>
            <h6>Description complète:</h6>
            <p style="white-space: pre-line;">{{ offre.description }}</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
            <a *ngIf="offre.lienExterne" [href]="offre.lienExterne" target="_blank" class="btn btn-primary">
              Postuler sur le site de l'entreprise
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>